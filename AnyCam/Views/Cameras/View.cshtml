@model AnyCam.Models.Camera

@{
    ViewData["Title"] = "View Camera";
}

<h1>@Model.Name</h1>

<div class="row">
    <div class="col-md-12">
        <img id="cameraStream" style="width: 100%; max-height: 600px;"
             data-stream-url="@ViewBag.StreamUrl"
             data-ip="@Model.IpAddress"
             data-port="@Model.Port"
             data-stream-url-full="@Model.StreamUrl">
    </div>
</div>

<div class="row mt-3">
    <div class="col-md-12">
        <button id="playBtn" class="btn btn-primary">Play</button>
        <button id="pauseBtn" class="btn btn-secondary">Pause</button>
        <button id="fullscreenBtn" class="btn btn-info">Fullscreen</button>
        <form asp-action="StartRecording" asp-route-id="@Model.Id" method="post" style="display: inline;">
            <button type="submit" class="btn btn-success">Start Recording (5 min)</button>
        </form>
    </div>
</div>

<script>
    const img = document.getElementById('cameraStream');
    const fullscreenBtn = document.getElementById('fullscreenBtn');

    function loadStream() {
        const streamUrl = img.dataset.streamUrl;
        if (streamUrl) {
            img.src = streamUrl;
        }
    }

    // Start loading immediately
    loadStream();

    fullscreenBtn.addEventListener('click', () => {
        if (img.requestFullscreen) {
            img.requestFullscreen();
        }
    });

    // Stop stream when page is unloaded
    window.addEventListener('beforeunload', () => {
        navigator.sendBeacon('/Cameras/StopStreaming/@Model.Id');
    });
</script>

<div>
    <a asp-action="Index">Back to List</a>
</div>